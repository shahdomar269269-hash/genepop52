<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GenePop BioLab</title>

<link rel="manifest" href="manifest.json">

<style>
body{
margin:0;
font-family:Arial;
background:#0a192f;
color:white;
text-align:center;
}

.top{
padding:8px;
background:#06121f;
font-weight:bold;
}

.screen{display:none;padding:15px}
.active{display:block}

button{
display:block;
width:95%;
margin:8px auto;
padding:14px;
border-radius:12px;
border:none;
font-size:18px;
background:#06d6a0;
}

canvas{
background:#13293d;
border-radius:10px;
margin:10px auto;
display:block;
}

.langBtn{
position:fixed;
top:8px;
right:8px;
background:#ffd166;
color:black;
}
</style>
</head>

<body>

<button class="langBtn" onclick="toggleLang()">ğŸŒ</button>

<div class="top">
ğŸ‘©â€ğŸ”¬ genepop |
â­ <span id="score">0</span> |
â¤ï¸ <span id="lives">3</span> |
ğŸ† <span id="high">0</span>
</div>

<!-- HOME -->
<div id="home" class="screen active">
<h2 id="title">ğŸ§¬ GenePop BioLab</h2>
<button onclick="start('dna')">DNA Lab</button>
<button onclick="start('punnett')">Punnett</button>
<button onclick="start('immune')">Immunity</button>
<button onclick="start('crispr')">CRISPR</button>
<button onclick="facts()">Fun Facts</button>
</div>

<!-- GAME -->
<div id="game" class="screen"></div>

<!-- MINI GAME CANVAS -->
<canvas id="lab" width="300" height="180"></canvas>

<script>
////////////////////////
// PWA
////////////////////////
if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}

////////////////////////
// SOUND
////////////////////////
const ctx=new (window.AudioContext||window.webkitAudioContext)();
function beep(f,t){let o=ctx.createOscillator();let g=ctx.createGain();
o.connect(g);g.connect(ctx.destination);
o.frequency.value=f;o.start();g.gain.value=.2;o.stop(ctx.currentTime+t);}
const good=()=>beep(900,.1);
const bad=()=>beep(200,.2);

////////////////////////
// SCORE
////////////////////////
let score=0,lives=3;
let high=localStorage.getItem("genepop_high")||0;
highEl.innerText=high;

function update(){
scoreEl.innerText=score;
livesEl.innerText=lives;
}

function saveHigh(){
if(score>high){
high=score;
localStorage.setItem("genepop_high",score);
highEl.innerText=score;
}
}

////////////////////////
// LANGUAGE
////////////////////////
let lang="ar";
function toggleLang(){
lang=lang=="ar"?"en":"ar";
title.innerText=lang=="ar"?"ğŸ§¬ Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¬ÙŠÙ†Ø§Øª":"ğŸ§¬ Gene Lab";
}

////////////////////////
// QUESTIONS 100+
////////////////////////
function genBank(){
let arr=[];
for(let i=0;i<25;i++){
arr.push(
["A pairs with ØŸ",["T","G","C"],0],
["aa is ØŸ",["Recessive","Dominant","Mutation"],0],
["CRISPR edits ØŸ",["DNA","Protein","Water"],0],
["Immune killer cellØŸ",["T cell","Neuron","RBC"],0]
);
}
return arr;
}

let bank=genBank();

////////////////////////
// GAME ENGINE
////////////////////////
let current=[],i=0;

function show(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

function start(){
score=0;lives=3;update();
current=[...bank].sort(()=>Math.random()-.5).slice(0,10);
i=0;
show("game");
next();
}

function next(){
if(i>=current.length){
saveHigh();
game.innerHTML="<h2>ğŸ‰ Level Complete</h2><button onclick='home()'>Home</button>";
return;
}

let q=current[i];
let html="<h3>"+q[0]+"</h3>";
q[1].forEach((a,idx)=>{
html+=`<button onclick="ans(${idx},${q[2]})">${a}</button>`;
});
game.innerHTML=html;
}

function ans(corr,real){
if(corr==real){score+=10;good();}
else{lives--;bad();}
update();

if(lives<=0){
saveHigh();
game.innerHTML="<h2>ğŸ’€ Game Over</h2><button onclick='home()'>Home</button>";
return;
}

i++;
next();
}

function home(){show("home");}

////////////////////////
// FUN FACTS
////////////////////////
const factsArr=[
"DNA length in your body reaches the sun!",
"CRISPR acts like scissors âœ‚ï¸",
"Vaccines train immune memory",
"Genes make proteins",
"99.9% DNA same in humans"
];

function facts(){
show("game");
let f=factsArr[Math.floor(Math.random()*factsArr.length)];
game.innerHTML="<h2>"+f+"</h2><button onclick='facts()'>Next</button><button onclick='home()'>Home</button>";
}

////////////////////////
// MINI LAB ANIMATION (Ø´Ø®ØµÙŠØ§Øª)
////////////////////////
let c=lab.getContext("2d");
let px=20,vx=260;

function draw(){
c.clearRect(0,0,300,180);

c.fillStyle="#ffd166"; // scientist
c.fillRect(px,90,20,20);

c.fillStyle="#ef476f"; // virus
c.beginPath();c.arc(vx,100,10,0,6.28);c.fill();

vx-=1;
if(vx<0)vx=300;

requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
